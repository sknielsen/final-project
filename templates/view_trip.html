{% extends 'base.html' %}
{% block content %}

<h2>{{ trip.name }}</h2>
<h3 id="trip-location">{{ trip.location }}</h3>
<h3>{{ trip.date }}</h3>
<h3>Entries</h3>
    {% if not entries %}
    <p>You dont have any entries yet!</p>
    {% else %}
      <ul> 
        {% for entry in entries %}
          <li class="entry">
          <p class="entry-link"><a href="/trip/{{ trip.trip_id }}/{{ entry.entry_id }}" class="entry-name">{{ entry.name }}</a></p>
          <p class="entry-category">{{ entry.category.name }}</p>
          <div class="entry-address" hidden>{{ entry.address }}</div>
          <div class="entry-photo" hidden>{{ entry.photo_location }}</div>
          <div class="entry-notes" hidden>{{ entry.notes }}</div>
          </li>
        {% endfor %}
      </ul>
    {% endif %}
    <p><a href="/add-entry/{{ trip.trip_id }}">Add new Entry</a></p>
    <div id="map"></div>
    <script>

      var tripLocation = $( '#trip-location' ).html();

      function initMap() {
        geocoder = new google.maps.Geocoder();
        var mapOptions = 
        {
          zoom: 11
        }
        map = new google.maps.Map(document.getElementById('map'), mapOptions);
        codeCenterAddress(tripLocation);
        addMarkers();
      }

      function codeCenterAddress(address) {
        geocoder.geocode( {address:address}, function(results, status) 
        {
          if (status == google.maps.GeocoderStatus.OK) 
          {
            map.setCenter(results[0].geometry.location);//center the map over the result
          } else {
            alert('Geocode was not successful for the following reason: ' + status);
         }
        });
      }

      function codeMarkerAddress(address, name, contentString) {
        geocoder.geocode( {address:address}, function(results, status) {
          if (status == google.maps.GeocoderStatus.OK) {
            // map.setCenter(results[0].geometry.location);//center the map over the result
            // place a marker at the location
            var marker = new google.maps.Marker({
                map: map,
                position: results[0].geometry.location,
                title: name
            });
            var infowindow = new google.maps.InfoWindow({
            content: contentString
            });

            marker.addListener('click', function() {
            infowindow.open(map, marker);
        });
          } else {
            alert('Geocode was not successful for the following reason: ' + status);
         }
        });
      }


      function addMarkers() {
        $( ".entry" ).each(function() {
        var address = $(this).children(".entry-address").html();
        var name = $(this).children(".entry-link").children(".entry-name").html();
        var category = $(this).children(".entry-category").html();
        var photo = $(this).children(".entry-photo").html();
        var notes = $(this).children(".entry-notes").html();
        var link = $(this).children(".entry-link").children(".entry-name").attr("href");
        var contentString = '<div id="content">'+
            '<h1><a href=\"'+link+'\">'+name+'</a></h1>'+
            '<div id="bodyContent">'+
            '<p>'+address+'</p>'+
            '<p>'+category+'</p>'+
            '<p>'+notes+'</p>'+
            '<img src=\"/'+photo+'\" height="100"</img>'+
            '</div>'+
            '</div>';
        codeMarkerAddress(address, name, contentString);
      });
      }


    </script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCH3NV21lKUUJpatY7B06dgXTLQR0oikV4&callback=initMap">
    </script>

{% endblock %}