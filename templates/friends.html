{% extends 'base.html' %}
{% block content %}
<div>
    <h2>Friends</h2>
    <ul>Friend Requests
    {% if not friend_requests %}
      <p>You dont have any outstanding friend requests!</p>
    {% else %}
      {% for friend in friend_requests %}
      <li>{{ friend.requester.name }}<div class="accepted-action" name="{{ friend.friend_id }}"><button name="{{ friend.friend_id }}" class="accepted-friend">Accept</button><button name="{{ friend.friend_id }}" class="denied-friend">Deny</button></div></li>
      {% endfor %}
    {% endif %}
  </ul>
    <ul>Your Friends
    {% if not friends %}
      <p>You dont have any friends yet!</p>
    {% else %}
      {% for friend in friends %}
        <li>{{ friend.name }}</li>
      {% endfor %}
    {% endif %}
    </ul>
  </div>

  <script>

    //Ajax request to accept friend
    function friendAccepted(result) {
      var status = result['request_id'];
      $("button[name=status]").remove();
      $("div[name=status]").html('Accepted!');
    }

    //Ajax call
    function requestAccept() {
      var formInputs = {
        "response": this.getAttribute("name")
      };
      $.post("/accept-friend.json", formInputs, friendAccepted);
    }

  // Add event handler to all friend request accept buttons
  $('.accepted-friend').on('click', requestAccept)


    //Ajax request to accept friend
    function friendDenied(result) {
      var status = result['request_id'];
      $("button[name=status]").remove();
      $("div[name=status]").html('Denied!');
    }

    //Ajax call
    function requestDeny() {
      var formInputs = {
        "response": this.getAttribute("name")
      };
      $.post("/deny-friend.json", formInputs, friendDenied);
    }

  // Add event handler to all friend request accept buttons
  $('.denied-friend').on('click', requestDeny)

  </script>
{% endblock %}